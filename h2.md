# h2 Break and Unbreak

## Pöytäkoneen Ympäristö
- Windows 11
- CPU: AMD Ryzen 9 5700X 12-Core Processor
- RAM: 32GB
- GPU: Nvidia Geforce RTX 3070 8GB
- Disc size 2TB

## Virtuaalikoneen ympäristö

<img width="551" height="655" alt="image" src="https://github.com/user-attachments/assets/0947c51d-fa57-457f-ae23-86b63941ef0e" />

## Tiiviste

- Owasp broken access control. Access control tarkoittaa sitä että käyttäjä ei voi tehdä asioita ilman annettua käyttöoikeuslupaa. Access controllia voi rikkoa mm. muuttamalla url-osoitetta, käyttämällä toisen käyttäjää, metadata manipulaatiota, ym. Miten estää ihmisiä rikkomasta access controllia on esimerkiksi vahvistamalla että käyttäjä on kuka väittää vaikka pyytämällä tietoja tai sertifikaatteja tai logittamalla kirjautumiset tai tunkeutumiset joka hälyttää ylläpitäjän.
- Find hidden web directories. Ohjeita miten ladata fuff, miten sitä käytetään, ja esimerkkiharjoitus mitä voi tehdä kokeillakseen fuffin käyttöä.
- PortSwigger. Access control vulnerabilities and privileges. Selittää access controllin eri muodoista. Vertikaalinen access control tarkoittaa sitä että toisella käyttäjällä on eri oikeudet samaan käyttäjään, esim. pääkäyttäjällä on oikeus poistaa käyttäjä mutta tavallisella käyttäjällä ei ole. Horisontaalinen access control on että käyttäjällä on oikeus omaan käyttäjään mutta ei rinnakkaisiin käyttäjiin, esim. käyttäjällä on oikeus omaan pankkitiliin mutta ei muihin. PortSwiggerissä on labroja mitä voi tehdä access controlliin liittyen.

## Break into 010 staff

- Tässä harjoituksessa on tarkoitus murtautua 010 staff only nettisivuun

- Aloitan lataamalla wget unzipin
<img width="663" height="22" alt="image" src="https://github.com/user-attachments/assets/5b0cc945-ff6a-40a9-9a3e-6a6985ac45df" />

- Sen jälkeen lataan tero karvisen kansion mistä löytyy harjoitukset 010 ja 020 + materiaalit.
<img width="869" height="24" alt="image" src="https://github.com/user-attachments/assets/7de0ed09-d1bb-402c-a67c-7803642b45a5" />

- Puran paketin.
<img width="557" height="27" alt="image" src="https://github.com/user-attachments/assets/f61be520-6507-4407-91de-f4ea569ec410" />

- Aloitan harjoituksen 010 tekoa menemällä 010 hakemistokansioon.
<img width="537" height="37" alt="image" src="https://github.com/user-attachments/assets/7031e190-534b-44ee-8579-995b103d4011" />

- Jatkan ohjeistuksen mukaisesti ja selvitän mistä lataan kyseisen paketin
<img width="911" height="112" alt="image" src="https://github.com/user-attachments/assets/5b98c99b-34c8-41a4-b86b-3c03e01dfc92" />

- Lataan python3 flaskin.
<img width="924" height="41" alt="image" src="https://github.com/user-attachments/assets/c8592356-e2a4-419a-9928-f52db64ec88a" />

- Nyt kun runaan pythonin niin näyttää toimivan ja voin avata sivun selaimella.
<img width="926" height="350" alt="image" src="https://github.com/user-attachments/assets/e164f714-099d-4f97-865b-0b5d5f274cf6" />

- Pääsin yhdistämään selaimeen
<img width="1245" height="646" alt="image" src="https://github.com/user-attachments/assets/8a588cf8-53ff-48f4-9bc3-a6f5e941583c" />

- Yritän aluksi kirjoittaa 123 kenttään mutta mitään ei tapahdu.
- Tässä vaiheessa en oikein tiedä paljon mitään SQL-injektioista joten tutkin eri mahdollisuuksia miten kenttään voi laittaa muuta kun pelkkiä numeroita ja sitten muistan että voi painaa shift + ctrl + c että avaa editorin. Vaihdan salasanakentän type="number" -> type="".
<img width="451" height="53" alt="image" src="https://github.com/user-attachments/assets/e52df907-a717-453b-a70a-8990a41b8d6a" />

- Laitoin ' OR 1=1-- ja sain your password is foo, mikä ei ollut superadminin string.
<img width="690" height="109" alt="image" src="https://github.com/user-attachments/assets/a71feb41-f3c4-47f1-a588-945ad221db01" />

- Yritin etsiä netistä ratkaisua ja parin sivun selailun jälkeen löysin sellaisen kun Union attacks PortSwiggeristä https://portswigger.net/web-security/sql-injection/union-attacks
- Tutkin tätä ja yritän ratkaisua ' UNION SELECT password FROM pins-- koska sivun alhaalla lukee "SELECT password FROM pins", joka on hyvä vinkki ja UNION etsii koko columnin.
- Se toimi!
<img width="971" height="119" alt="image" src="https://github.com/user-attachments/assets/d333e27e-c8a1-49fe-acc3-20a2f7b31694" />

## Fix the staff vulnerability from source code.

- Avaan tiedoston suorittamalla koodin $ nano staff-only-py
- En oikein osaa vielä korjata pythonia tai tiedä SQL tarpeeksi joten kysyn copilotilta miten koodi korjataan että UNION hyökkäyksiä ei voida enää suorittaa.
<img width="874" height="840" alt="image" src="https://github.com/user-attachments/assets/1f37e70d-a1e8-4adc-9c4a-8e55ae2cad5d" />

- Päädyin tällaiseen ratkaisuun koska se estää UNION SQL iskuja ja pakottaa pinin olemaan integer mikä estää kaikkia hassuja hyökkyksiä mitä voisi yrittää.
<img width="867" height="241" alt="image" src="https://github.com/user-attachments/assets/e7f501d6-8808-4745-903d-af6fe54f1061" />

- Tallennan koodin, avaan staff-only.py tiedoston uudestaan verkkosivuun ja laitan ' UNION SELECT password FROM pins-- uudestaan ja se ei enää toimi.
<img width="814" height="247" alt="image" src="https://github.com/user-attachments/assets/7bf52a24-1c0f-4ed7-9acd-1414642553ce" />




## Lähteet

- Tero Karvinen Application hacking. terokarvinen.com. 20.1.2026. https://terokarvinen.com/application-hacking/
- OWASP org. Broken access control. 20.1.2026. https://owasp.org/Top10/2021/A01_2021-Broken_Access_Control/index.html
- Terokarvinen.com 2023. Find hidden web directories. https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/
- PortSwigger. Access control vulnerabilities and privileges. https://portswigger.net/web-security/access-control
