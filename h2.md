# h2 Break and Unbreak

## Pöytäkoneen Ympäristö
- Windows 11
- CPU: AMD Ryzen 9 5700X 12-Core Processor
- RAM: 32GB
- GPU: Nvidia Geforce RTX 3070 8GB
- Disc size 2TB

## Virtuaalikoneen ympäristö

<img width="551" height="655" alt="image" src="https://github.com/user-attachments/assets/0947c51d-fa57-457f-ae23-86b63941ef0e" />

## Tiiviste

- Owasp broken access control. Access control tarkoittaa sitä että käyttäjä ei voi tehdä asioita ilman annettua käyttöoikeuslupaa. Access controllia voi rikkoa mm. muuttamalla url-osoitetta, käyttämällä toisen käyttäjää, metadata manipulaatiota, ym. Miten estää ihmisiä rikkomasta access controllia on esimerkiksi vahvistamalla että käyttäjä on kuka väittää vaikka pyytämällä tietoja tai sertifikaatteja tai logittamalla kirjautumiset tai tunkeutumiset joka hälyttää ylläpitäjän.
- Find hidden web directories. Ohjeita miten ladata fuff, miten sitä käytetään, ja esimerkkiharjoitus mitä voi tehdä kokeillakseen fuffin käyttöä.
- PortSwigger. Access control vulnerabilities and privileges. Selittää access controllin eri muodoista. Vertikaalinen access control tarkoittaa sitä että toisella käyttäjällä on eri oikeudet samaan käyttäjään, esim. pääkäyttäjällä on oikeus poistaa käyttäjä mutta tavallisella käyttäjällä ei ole. Horisontaalinen access control on että käyttäjällä on oikeus omaan käyttäjään mutta ei rinnakkaisiin käyttäjiin, esim. käyttäjällä on oikeus omaan pankkitiliin mutta ei muihin. PortSwiggerissä on labroja mitä voi tehdä access controlliin liittyen.

## Break into 010 staff

- Tässä harjoituksessa on tarkoitus murtautua 010 staff only nettisivuun

- Aloitan lataamalla wget unzipin
<img width="663" height="22" alt="image" src="https://github.com/user-attachments/assets/5b0cc945-ff6a-40a9-9a3e-6a6985ac45df" />

- Sen jälkeen lataan tero karvisen kansion mistä löytyy harjoitukset 010 ja 020 + materiaalit.
<img width="869" height="24" alt="image" src="https://github.com/user-attachments/assets/7de0ed09-d1bb-402c-a67c-7803642b45a5" />

- Puran paketin.
<img width="557" height="27" alt="image" src="https://github.com/user-attachments/assets/f61be520-6507-4407-91de-f4ea569ec410" />

- Aloitan harjoituksen 010 tekoa menemällä 010 hakemistokansioon.
<img width="537" height="37" alt="image" src="https://github.com/user-attachments/assets/7031e190-534b-44ee-8579-995b103d4011" />

- Jatkan ohjeistuksen mukaisesti ja selvitän mistä lataan kyseisen paketin
<img width="911" height="112" alt="image" src="https://github.com/user-attachments/assets/5b98c99b-34c8-41a4-b86b-3c03e01dfc92" />

- Lataan python3 flaskin.
<img width="924" height="41" alt="image" src="https://github.com/user-attachments/assets/c8592356-e2a4-419a-9928-f52db64ec88a" />

- Nyt kun runaan pythonin niin näyttää toimivan ja voin avata sivun selaimella.
<img width="926" height="350" alt="image" src="https://github.com/user-attachments/assets/e164f714-099d-4f97-865b-0b5d5f274cf6" />

- Pääsin yhdistämään selaimeen
<img width="1245" height="646" alt="image" src="https://github.com/user-attachments/assets/8a588cf8-53ff-48f4-9bc3-a6f5e941583c" />

- Yritän aluksi kirjoittaa 123 kenttään mutta mitään ei tapahdu.
- Tässä vaiheessa en oikein tiedä paljon mitään SQL-injektioista joten tutkin eri mahdollisuuksia miten kenttään voi laittaa muuta kun pelkkiä numeroita ja sitten muistan oppitunnilta että voin painaa shift + ctrl + c että avaa editorin. Vaihdan salasanakentän type="number" -> type="".
<img width="451" height="53" alt="image" src="https://github.com/user-attachments/assets/e52df907-a717-453b-a70a-8990a41b8d6a" />

- Laitoin ' OR 1=1-- ja sain your password is foo, mikä ei ollut superadminin string.
<img width="690" height="109" alt="image" src="https://github.com/user-attachments/assets/a71feb41-f3c4-47f1-a588-945ad221db01" />

- Yritin etsiä netistä ratkaisua ja parin sivun selailun jälkeen löysin sellaisen kun Union attacks PortSwiggeristä https://portswigger.net/web-security/sql-injection/union-attacks
- Tutkin tätä ja yritän ratkaisua ' UNION SELECT password FROM pins-- koska sivun alhaalla lukee "SELECT password FROM pins", joka on hyvä vinkki ja UNION etsii koko columnin.
- Se toimi!
<img width="971" height="119" alt="image" src="https://github.com/user-attachments/assets/d333e27e-c8a1-49fe-acc3-20a2f7b31694" />

## Fix the staff vulnerability from source code.

- Avaan 010 tehtävän tiedoston suorittamalla koodin $ nano staff-only-py
- En oikein osaa vielä korjata pythonia tai tiedä SQL tarpeeksi joten kysyn copilotilta miten koodi korjataan että UNION hyökkäyksiä ei voida enää suorittaa.
<img width="874" height="840" alt="image" src="https://github.com/user-attachments/assets/1f37e70d-a1e8-4adc-9c4a-8e55ae2cad5d" />

- Päädyin tällaiseen ratkaisuun koska se estää UNION SQL iskuja ja pakottaa pinin olemaan integer mikä estää kaikkia hassuja hyökkyksiä mitä voisi yrittää.
<img width="867" height="241" alt="image" src="https://github.com/user-attachments/assets/e7f501d6-8808-4745-903d-af6fe54f1061" />

- Tallennan koodin, avaan staff-only.py tiedoston uudestaan verkkosivuun ja laitan ' UNION SELECT password FROM pins-- uudestaan ja se ei enää toimi.
<img width="814" height="247" alt="image" src="https://github.com/user-attachments/assets/7bf52a24-1c0f-4ed7-9acd-1414642553ce" />

## Solve dirfutz-1 

- Tässä tehtävässä pitää löytää salaiset url osoitteet ffuf työkalun avulla.

- Lataan sample targetin Tero Karvisen nettisivulta, muutan oikeudet, suoritan ja avaan dirfuzt-1 osoitteen nettiselaimessa.
<img width="1044" height="22" alt="image" src="https://github.com/user-attachments/assets/46555db7-ba3b-4b3a-8cad-6ce3f0f8ee58" />
<img width="708" height="135" alt="image" src="https://github.com/user-attachments/assets/b446e46e-e2ed-4df5-953a-851faa9e592d" />



- Asennan ffufin
<img width="540" height="23" alt="image" src="https://github.com/user-attachments/assets/f8febf09-1307-47c6-96db-49fcddb7e387" />

- Ffuf tarvitsee sanakirjahtiedoston josta se hakee useimmat käytetyt hakemistosanat joten lataan Daniel Miesslerin seclistin.
<img width="803" height="39" alt="image" src="https://github.com/user-attachments/assets/b9566da8-c6d1-4449-97ee-bcba29da86f5" />

- Katkaisen nyt internet yhteyden omasta virtuaalikoneesta. Helpoin tapa ottaa internet pois päältä virtuaalikoneesta on täppää tämä asetus VirtualBox ohjelmassa.
<img width="538" height="235" alt="image" src="https://github.com/user-attachments/assets/2b351c45-82f9-4a33-a22a-c207f29a1a95" />
<img width="425" height="146" alt="image" src="https://github.com/user-attachments/assets/31bc4243-7840-47a7-9b19-672453e264f1" />

- Ja nyt alan käyttää ffuf-ohjelmaa. Etsin sen avulla tiedon mikä hakemisto löytyisi 127.0.0.2:8000.
<img width="853" height="20" alt="image" src="https://github.com/user-attachments/assets/da7e23f2-4b8a-4fc8-a22a-de91980e7657" />
<img width="944" height="61" alt="image" src="https://github.com/user-attachments/assets/69a45aa5-17d6-43f7-9bb4-2a4b54846ebc" />


- Ja se yhden hakemiston. Testaan sitä.
<img width="633" height="171" alt="image" src="https://github.com/user-attachments/assets/4e4a2a48-a945-447f-8280-8be7125fdc0e" />

- En onnistunut löytämään toista mutta olen ylpeä että löysin edes yhden niistä!

## Break into 020-your-eyes-only.

- Tässä osiossa teen suurinpiiretin samaa mitä tein 010 tehtävässä.
<img width="593" height="20" alt="image" src="https://github.com/user-attachments/assets/77fbac8b-5520-450f-90cc-d31e81af581f" />

- Lataan virtualenvin
<img width="908" height="20" alt="image" src="https://github.com/user-attachments/assets/fc11d136-f604-4190-900c-d286d0b641be" />

- Luon virtuaaliympristön ja aktivoin sen.
<img width="1083" height="172" alt="image" src="https://github.com/user-attachments/assets/57096560-e914-4a16-b595-f7e33764af37" />
<img width="969" height="44" alt="image" src="https://github.com/user-attachments/assets/050100b0-ea49-4020-a26b-02d904cf839f" />

- Tarvitsen Djangon että pystyn jatkamaan.
<img width="912" height="39" alt="image" src="https://github.com/user-attachments/assets/258681b7-2c2a-4abe-b5ba-99b2f088cb54" />
<img width="1263" height="227" alt="image" src="https://github.com/user-attachments/assets/07476cff-bd03-400c-85ac-4062be40d1be" />

- Siirryn uuteen hakemistoon.
<img width="893" height="293" alt="image" src="https://github.com/user-attachments/assets/69141f7c-98de-4bd4-a1dd-2ffdf1d3c780" />
<img width="1233" height="117" alt="image" src="https://github.com/user-attachments/assets/4ac9dacf-4937-4140-867b-dd7d89365de9" />

- Runaan testiservun
<img width="968" height="174" alt="image" src="https://github.com/user-attachments/assets/ff215aa9-e10c-404c-9e8d-958673b8d753" />

- En löydä suoraan mitään mihin voisin käyttää SQL injektiota joten käytän ffuf-ohjelmaa jos sillä löytyisi jotain kivaa.
<img width="1011" height="546" alt="image" src="https://github.com/user-attachments/assets/80bc4bd1-8afe-4e01-9d20-ddcefe26fa7c" />

- Yritin fuzzata mutta ei oikein tullut mitään hyödyllistä, avasin vinkit ja tajusin sen jälkeen että minun kannattaisi ehkä tehdä käyttäjä sivulle, joten teen käyttäjän.
- Tein käyttäjän "juujoo" ja yritän fuzzata uudestaan.

<img width="803" height="42" alt="image" src="https://github.com/user-attachments/assets/fbe0dc65-5e1d-44d1-b4f8-e054f26ad1fd" />
- Ja sieltä se tuli! Kesti hetken tajuta että piti oikeasti tehdä käyttäjä sivulle, piti vähän katsoa hinttejä sen takia.

<img width="522" height="160" alt="image" src="https://github.com/user-attachments/assets/7b82234e-a227-4ad5-ba2c-454122a8fe8e" />

Jee!!!

## Fix the 020-your-eyes-only vulnerability

- Sama juttu kun 010 virheenkorjauksessa, nanotan views.py tiedoston.

<img width="952" height="26" alt="image" src="https://github.com/user-attachments/assets/5e8d823a-6379-4871-b817-ac987d7c6363" />
<img width="897" height="382" alt="image" src="https://github.com/user-attachments/assets/f12d4fe4-08a2-4516-8939-2196b423bce7" />

- Taitaa puuttua "and self.request.user.is_staff" tuosta ihan lopusta, koska muuten kuka vaan joka ei ole staff pystyy näkemään AdminShowAllView. En ole ihan varma mutta testataan.
<img width="966" height="382" alt="image" src="https://github.com/user-attachments/assets/510bf3e9-7795-4f55-8958-da704bd7e4ef" />

- Korjattu! En kyllä uskonut että tämä keissi olisi ollut näin yksinkertainen koska löin jo amatöörikoodarina päätä seinään 010 virheenkorjauksesta eteenkin koska en edes osaa python ohjelmointikieltä kunnolla.
<img width="653" height="141" alt="image" src="https://github.com/user-attachments/assets/00b53efc-ac01-4899-9b48-63e1b5ea082e" />

## Pohdinta

- Tykkäsin näistä tehtävistä todella paljon ja olen kyllä ylpeä että sain kaikki pakolliset suoritettua vaikka 010 olikin aika haastava, mutta sitten kun pääsi asiaan kiinni niin se meni ihan sulavasti.
- Pakko sanoa että tehtävät oli aivan mahtavia, parhaimmat tähän asti ja niistä oikeesti oppi ja varmasti jää päähän, pidin näistä erittäin paljon ehkä parhaimmat kotiläksyt ikinä?
- En ole pahemmin koodaillut webcodea tai pythonia joten piti vähän copilotia päräyttää että saa virheenkorjauksen hoidettua koska en itse osaa, hyvä että ratkaisu toimi, mutta olen hyvin ylpeä siitä että osasin nähdä 020 tehtävän haavoittuvuuden.
- Ffuf vaikuttaa mielenkiintoiselta ohjelmalta ja sen kuuluukin laittaa miettimään että miten turvaa omat nettisivut fuzz hyökkäyksiltä.

## Lähteet

- Tero Karvinen Application hacking. terokarvinen.com. 20.1.2026. https://terokarvinen.com/application-hacking/
- OWASP org. Broken access control. 20.1.2026. https://owasp.org/Top10/2021/A01_2021-Broken_Access_Control/index.html
- Terokarvinen.com 2023. Find hidden web directories. https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/
- PortSwigger. Access control vulnerabilities and privileges. https://portswigger.net/web-security/access-control
- PortSwigger. Union Attacks. https://portswigger.net/web-security/sql-injection/union-attacks
- Microsoft Copilot.
